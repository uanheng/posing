# 单线雷达带反光板定位算法

本算法使用倍加福2000雷达加上反光板作为定位的硬件.

## 反光板匹配定位

### 分割反光板点云

使用固定阈值分割分离反光板点云，并根据反光板的远近粗略估计点云数量而过滤错误反光板点云，公式如下:

$ n=2\arctan (\frac{r}{l})/f $

其中n为理论反光板点云数量，r为反光板半径，f为激光雷达角分辨率，l为反光板到激光雷达的距离.

### 获取反光板坐标

在获取到反光板的激光点云后，使用**三角函数法**计算反光板的圆心。

### 匹配反光板

使用三角形匹配法确定各反光板的序号，首先将地图中的所有反光板组成的三角形根据边长进行排序，在通过局部反光板形成的三角形进行匹配。

### 三边定位

假设激光雷达扫描到 n 个反光板(n≥3),则
$\left\{\begin{array}{c}\left(x_{P}-x_{1}\right)^{2}+\left(y_{P}-y_{1}\right)^{2}=r_{1}^{2} \\ \vdots \\ \left(x_{P}-x_{n}\right)^{2}+\left(y_{P}-y_{n}\right)^{2}=r_{n}^{2}\end{array}\right.$
用其中的前n − 1个方程减去第n个方程,可以得到
$AX_{P} = b$
其中 
$A=\left[\begin{array}{cc}2\left(x_{1}-x_{n}\right) & 2\left(y_{1}-y_{n}\right. \\ \vdots & \vdots \\ 2\left(x_{n-1}-x_{n}\right) & 2\left(y_{n-1}-y_{n}\right)\end{array}\right]$
$b=\left[\begin{array}{c}x_{1}^{2}-x_{n}^{2}+y_{1}^{2}-y_{n}^{2}+r_{n}^{2}-r_{1}^{2} \\ \vdots \\ x_{n-1}^{2}-x_{n}^{2}+y_{n-1}^{2}-y_{n}^{2}+r_{n}^{2}-r_{n-1}^{2}\end{array}\right]$
使用最小二乘法得到全局坐标，并算出偏转角度，如下：
$X_{P} = (A^{T}A)^{-1}A^{T}b$
$\theta_{P}=\frac{1}{n}\sum_{i=1}^{n}\arctan \frac{x_i-x_p}{y_i-y_p}-\varphi_i$